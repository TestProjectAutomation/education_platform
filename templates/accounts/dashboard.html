{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" %}{% endblock %}

{% block extra_css %}
<style>
    /* Custom Dashboard Styles */
    .dashboard-card {
        background: linear-gradient(135deg, var(--card-bg, #ffffff), #f8fafc);
        border: 1px solid var(--card-border, #e2e8f0);
        transition: all 0.3s ease;
    }
    
    .dark .dashboard-card {
        background: linear-gradient(135deg, var(--card-bg-dark, #1e293b), #0f172a);
        border-color: var(--card-border-dark, #334155);
    }
    
    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .dark .dashboard-card:hover {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    .stat-card {
        position: relative;
        overflow: hidden;
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
    }
    
    .progress-ring {
        transform: rotate(-90deg);
    }
    
    .progress-ring-circle {
        transition: stroke-dashoffset 0.5s ease;
    }
    
    .quick-action-btn {
        background: linear-gradient(135deg, var(--primary-color), #7c3aed);
        color: white;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .quick-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
    }
    
    .quick-action-btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%);
        transform-origin: 50% 50%;
    }
    
    .quick-action-btn:focus:not(:active)::after {
        animation: ripple 1s ease-out;
    }
    
    @keyframes ripple {
        0% {
            transform: scale(0, 0);
            opacity: 0.5;
        }
        100% {
            transform: scale(20, 20);
            opacity: 0;
        }
    }
    
    .activity-timeline {
        position: relative;
        padding-left: 2rem;
    }
    
    .activity-timeline::before {
        content: '';
        position: absolute;
        left: 0.75rem;
        top: 0;
        bottom: 0;
        width: 2px;
        background: linear-gradient(to bottom, var(--primary-color), transparent);
    }
    
    .activity-item {
        position: relative;
        padding-bottom: 1.5rem;
    }
    
    .activity-item::before {
        content: '';
        position: absolute;
        left: -1.25rem;
        top: 0;
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 50%;
        background: var(--primary-color);
        border: 3px solid white;
        box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
    }
    
    .dark .activity-item::before {
        border-color: #1e293b;
    }
    
    .course-progress-bar {
        height: 8px;
        border-radius: 4px;
        background-color: #e2e8f0;
        overflow: hidden;
    }
    
    .dark .course-progress-bar {
        background-color: #334155;
    }
    
    .course-progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        border-radius: 4px;
        transition: width 1s ease;
    }
    
    .achievement-badge {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
        position: relative;
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }
    
    .achievement-badge.locked {
        background: linear-gradient(135deg, #9ca3af, #6b7280);
        filter: grayscale(1);
        opacity: 0.7;
    }
    
    .achievement-badge::after {
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 50%;
        background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.2));
        z-index: -1;
    }
    
    /* Chart container styles */
    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
    }
    
    /* Loading skeleton */
    .skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
    }
    
    .dark .skeleton {
        background: linear-gradient(90deg, #2d3748 25%, #4a5568 50%, #2d3748 75%);
    }
    
    @keyframes loading {
        0% {
            background-position: 200% 0;
        }
        100% {
            background-position: -200% 0;
        }
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<nav class="mb-6" aria-label="{% trans 'Ø§Ù„ØªÙ†Ù‚Ù„' %}">
    <ol class="flex flex-wrap items-center text-sm text-gray-600 dark:text-gray-400">
        <li class="flex items-center">
            <a href="{% url 'core:home' %}" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                {% trans "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" %}
            </a>
            <svg class="w-4 h-4 mx-2 rtl:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </li>
        <li>
            <span class="text-gray-800 dark:text-gray-200 font-medium">{% trans "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" %}</span>
        </li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
                {% trans "Ù…Ø±Ø­Ø¨Ø§Ù‹" %}ØŒ {{ user.get_full_name|default:user.username }}
                ğŸ‘‹
            </h1>
            <p class="text-gray-600 dark:text-gray-400">
                {% trans "Ù‡Ø°Ù‡ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ù†Ø´Ø§Ø·Ùƒ ÙˆØªÙ‚Ø¯Ù…Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©" %}
                <span id="currentTime" class="text-primary-600 dark:text-primary-400 font-medium"></span>
            </p>
        </div>
        
        <div class="flex items-center space-x-3 rtl:space-x-reverse">
            <!-- Quick Stats -->
            <div class="hidden md:flex items-center space-x-4 rtl:space-x-reverse">
                <div class="text-center">
                    <div class="text-2xl font-bold text-primary-600 dark:text-primary-400">{{ user.courses_enrolled.count }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">{% trans "Ø¯ÙˆØ±Ø©" %}</div>
                </div>
                <div class="h-8 w-px bg-gray-300 dark:bg-gray-700"></div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600 dark:text-green-400">{{ user.completed_courses.count }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">{% trans "Ù…ÙƒØªÙ…Ù„" %}</div>
                </div>
                <div class="h-8 w-px bg-gray-300 dark:bg-gray-700"></div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ user.get_points }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">{% trans "Ù†Ù‚Ø·Ø©" %}</div>
                </div>
            </div>
            
            <!-- View Profile Button -->
            <a href="{% url 'accounts:profile' %}" 
               class="flex items-center px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                <i class="fas fa-user-circle mr-2 text-gray-600 dark:text-gray-400"></i>
                <span class="text-sm font-medium">{% trans "Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ" %}</span>
            </a>
        </div>
    </div>
    
    <!-- Welcome Banner -->
    <div class="mt-6 p-6 rounded-xl bg-gradient-to-r from-primary-500 to-purple-600 text-white dashboard-card">
        <div class="flex flex-col md:flex-row md:items-center justify-between">
            <div class="mb-4 md:mb-0">
                <h2 class="text-xl font-bold mb-2">{% trans "Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù…!" %}</h2>
                <p class="opacity-90">
                    {% if user.active_courses %}
                        {% trans "Ù„Ø¯ÙŠÙƒ" %} {{ user.active_courses.count }} {% trans "Ø¯ÙˆØ±Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…. Ø§Ø³ØªÙ…Ø± ÙÙŠ ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§ÙÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©!" %}
                    {% else %}
                        {% trans "Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„ÙŠÙˆÙ… Ù…Ø¹ Ø£Ø­Ø¯ Ø¯ÙˆØ±Ø§ØªÙ†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²Ø©!" %}
                    {% endif %}
                </p>
            </div>
            <div class="flex space-x-3 rtl:space-x-reverse">
                <a href="" 
                   class="px-6 py-2 bg-white text-primary-600 font-medium rounded-lg hover:bg-opacity-90 transition-colors">
                    {% trans "Ø§Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª" %}
                </a>
                {% if user.active_courses %}
                <a href="" 
                   class="px-6 py-2 bg-transparent border-2 border-white text-white font-medium rounded-lg hover:bg-white hover:text-primary-600 transition-colors">
                    {% trans "Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù…" %}
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Dashboard Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Left Column -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Progress Overview -->
        <div class="dashboard-card rounded-xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                    <i class="fas fa-chart-line mr-2 text-primary-600"></i>
                    {% trans "ØªÙ‚Ø¯Ù…Ùƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ" %}
                </h2>
                <div class="relative">
                    <select id="progressPeriod" 
                            class="appearance-none bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg px-4 py-2 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500">
                        <option value="week">{% trans "Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹" %}</option>
                        <option value="month" selected>{% trans "Ø¢Ø®Ø± Ø´Ù‡Ø±" %}</option>
                        <option value="year">{% trans "Ø¢Ø®Ø± Ø³Ù†Ø©" %}</option>
                        <option value="all">{% trans "Ø§Ù„ÙƒÙ„" %}</option>
                    </select>
                    <div class="absolute left-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                        <i class="fas fa-calendar text-gray-400"></i>
                    </div>
                </div>
            </div>
            
            <!-- Progress Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="stat-card p-4 rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">{% trans "Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©" %}</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ user.completed_courses.count }}</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                            <i class="fas fa-check-circle text-blue-600 dark:text-blue-400 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-3 text-sm text-blue-600 dark:text-blue-400">
                        <i class="fas fa-arrow-up mr-1"></i>
                        12% {% trans "Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ" %}
                    </div>
                </div>
                
                <div class="stat-card p-4 rounded-lg bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">{% trans "Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…" %}</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ user.total_learning_hours|floatformat:1 }}</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
                            <i class="fas fa-clock text-green-600 dark:text-green-400 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-3 text-sm text-green-600 dark:text-green-400">
                        <i class="fas fa-arrow-up mr-1"></i>
                        8% {% trans "Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ" %}
                    </div>
                </div>
                
                <div class="stat-card p-4 rounded-lg bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">{% trans "Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²" %}</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ user.get_points }}</p>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-purple-100 dark:bg-purple-900 flex items-center justify-center">
                            <i class="fas fa-trophy text-purple-600 dark:text-purple-400 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-3 text-sm text-purple-600 dark:text-purple-400">
                        <i class="fas fa-arrow-up mr-1"></i>
                        15% {% trans "Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ" %}
                    </div>
                </div>
            </div>
            
            <!-- Progress Chart -->
            <div class="relative">
                <div class="chart-container" id="progressChartContainer">
                    <canvas id="progressChart"></canvas>
                </div>
                <div id="chartLoading" class="absolute inset-0 flex items-center justify-center bg-white dark:bg-gray-800 bg-opacity-90">
                    <div class="text-center">
                        <div class="w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-3"></div>
                        <p class="text-gray-600 dark:text-gray-400">{% trans "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..." %}</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Active Courses -->
        <div class="dashboard-card rounded-xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                    <i class="fas fa-play-circle mr-2 text-primary-600"></i>
                    {% trans "Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©" %}
                </h2>
                {% comment %} <a href="{% url 'accounts:my_courses' %}" 
                   class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 text-sm font-medium">
                    {% trans "Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„" %} <i class="fas fa-arrow-left mr-1"></i>
                </a> {% endcomment %}
            </div>
            
            {% if user.active_courses %}
            <div class="space-y-4">
                {% for enrollment in user.active_courses|slice:":3" %}
                <div class="flex flex-col md:flex-row md:items-center gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <div class="flex-shrink-0">
                        <a href="{{ enrollment.course.get_absolute_url }}">
                            <div class="w-20 h-20 rounded-lg overflow-hidden">
                                {% if enrollment.course.thumbnail %}
                                <img src="{{ enrollment.course.thumbnail.url }}" 
                                     alt="{{ enrollment.course.title }}"
                                     class="w-full h-full object-cover">
                                {% else %}
                                <div class="w-full h-full bg-gradient-to-br from-primary-500 to-purple-600 flex items-center justify-center">
                                    <i class="fas fa-book-open text-white text-xl"></i>
                                </div>
                                {% endif %}
                            </div>
                        </a>
                    </div>
                    
                    <div class="flex-1">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-2">
                            <div>
                                <a href="{{ enrollment.course.get_absolute_url }}" 
                                   class="font-medium text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400">
                                    {{ enrollment.course.title }}
                                </a>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                                    {{ enrollment.course.instructor.get_full_name|default:enrollment.course.instructor.username }}
                                </p>
                            </div>
                            <div class="mt-2 md:mt-0">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-{{ enrollment.course.level_color }}-100 text-{{ enrollment.course.level_color }}-800 dark:bg-{{ enrollment.course.level_color }}-900 dark:text-{{ enrollment.course.level_color }}-300">
                                    {{ enrollment.course.get_level_display }}
                                </span>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <div class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 mb-1">
                                <span>{% trans "Ø§Ù„ØªÙ‚Ø¯Ù…" %}</span>
                                <span>{{ enrollment.progress_percentage }}%</span>
                            </div>
                            <div class="course-progress-bar">
                                <div class="course-progress-fill" style="width: {{ enrollment.progress_percentage }}%"></div>
                            </div>
                            
                            <div class="flex items-center justify-between mt-3">
                                <div class="flex items-center text-sm text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>{{ enrollment.last_accessed|default:"Ù„Ù… ØªØ¨Ø¯Ø§ Ø¨Ø¹Ø¯" }}</span>
                                </div>
                                <a href="{{ enrollment.course.get_absolute_url }}?continue=true" 
                                   class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 text-sm font-medium">
                                    {% if enrollment.progress_percentage > 0 %}
                                        {% trans "Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù…" %} <i class="fas fa-arrow-left mr-1"></i>
                                    {% else %}
                                        {% trans "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†" %} <i class="fas fa-arrow-left mr-1"></i>
                                    {% endif %}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-12">
                <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
                    <i class="fas fa-book-open text-gray-400 text-2xl"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">{% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ù†Ø´Ø·Ø©" %}</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto">
                    {% trans "Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„ÙŠÙˆÙ…! Ø§Ø®ØªØ± Ù…Ù† Ø¨ÙŠÙ† Ù…Ø¦Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ù…Ù…ÙŠØ²Ø©." %}
                </p>
                <a href="" 
                   class="inline-flex items-center px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors">
                    <i class="fas fa-search mr-2"></i>
                    {% trans "Ø§Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª" %}
                </a>
            </div>
            {% endif %}
        </div>
        
        <!-- Recent Activity -->
        <div class="dashboard-card rounded-xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                    <i class="fas fa-history mr-2 text-primary-600"></i>
                    {% trans "Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±" %}
                </h2>
                <button id="refreshActivity" 
                        class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-redo text-gray-600 dark:text-gray-400"></i>
                </button>
            </div>
            
            <div class="activity-timeline">
                {% if recent_activities %}
                {% for activity in recent_activities|slice:":5" %}
                <div class="activity-item">
                    <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 shadow-sm">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 mt-1">
                                <div class="w-10 h-10 rounded-full {{ activity.icon_bg }} flex items-center justify-center">
                                    <i class="{{ activity.icon }} {{ activity.icon_color }}"></i>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <div class="flex items-center justify-between">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">
                                        {{ activity.title }}
                                    </p>
                                    <span class="text-xs text-gray-500 dark:text-gray-400">
                                        {{ activity.timestamp }}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">
                                    {{ activity.description }}
                                </p>
                                {% if activity.link %}
                                <a href="{{ activity.link }}" 
                                   class="inline-flex items-center text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 mt-2">
                                    {% trans "Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„" %} <i class="fas fa-arrow-left mr-1"></i>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                {% if recent_activities.count > 5 %}
                <div class="text-center mt-4">
                    <a href="{% url 'accounts:activity' %}" 
                       class="inline-flex items-center text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium">
                        {% trans "Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª" %} <i class="fas fa-arrow-left mr-1"></i>
                    </a>
                </div>
                {% endif %}
                
                {% else %}
                <div class="text-center py-8">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
                        <i class="fas fa-history text-gray-400 text-xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">{% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ø­Ø¯ÙŠØ«Ø©" %}</h3>
                    <p class="text-gray-600 dark:text-gray-400">
                        {% trans "Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„ØªØ¹Ù„Ù… Ù„ØªØ¸Ù‡Ø± Ù†Ø´Ø§Ø·Ø§ØªÙƒ Ù‡Ù†Ø§" %}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Right Column -->
    <div class="space-y-6">
        <!-- Quick Actions -->
        <div class="dashboard-card rounded-xl p-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-bolt mr-2 text-yellow-500"></i>
                {% trans "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©" %}
            </h2>
            
            <div class="grid grid-cols-2 gap-3">
                <a href="" 
                   class="quick-action-btn p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <i class="fas fa-search text-xl mb-2"></i>
                    <span class="text-sm font-medium">{% trans "Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙˆØ±Ø§Øª" %}</span>
                </a>
                
                {% comment %} <a href="{% url 'accounts:my_courses' %}" 
                   class="quick-action-btn p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <i class="fas fa-book-open text-xl mb-2"></i>
                    <span class="text-sm font-medium">{% trans "Ø¯ÙˆØ±Ø§ØªÙŠ" %}</span>
                </a> {% endcomment %}
                
                {% comment %} <a href="{% url 'accounts:bookmarks' %}" 
                   class="quick-action-btn p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <i class="fas fa-bookmark text-xl mb-2"></i>
                    <span class="text-sm font-medium">{% trans "Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª" %}</span>
                </a> {% endcomment %}
                
                {% comment %} <a href="{% url 'accounts:certificates' %}" 
                   class="quick-action-btn p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <i class="fas fa-certificate text-xl mb-2"></i>
                    <span class="text-sm font-medium">{% trans "Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª" %}</span>
                </a> {% endcomment %}
{% comment %}                 
                <a href="{% url 'accounts:settings' %}" 
                   class="quick-action-btn p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <i class="fas fa-cog text-xl mb-2"></i>
                    <span class="text-sm font-medium">{% trans "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" %}</span>
                </a>
                 {% endcomment %}
                <a href="{% url 'core:contact' %}" 
                   class="quick-action-btn p-4 rounded-lg flex flex-col items-center justify-center text-center">
                    <i class="fas fa-headset text-xl mb-2"></i>
                    <span class="text-sm font-medium">{% trans "Ø§Ù„Ø¯Ø¹Ù…" %}</span>
                </a>
            </div>
        </div>
        
        <!-- Upcoming Deadlines -->
        <div class="dashboard-card rounded-xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                    <i class="fas fa-calendar-alt mr-2 text-red-500"></i>
                    {% trans "Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠØ© Ù‚Ø±ÙŠØ¨Ø©" %}
                </h2>
                <span class="text-xs text-gray-500 dark:text-gray-400">{% trans "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…" %}</span>
            </div>
            
            {% if upcoming_deadlines %}
            <div class="space-y-4">
                {% for deadline in upcoming_deadlines|slice:":3" %}
                <div class="flex items-start p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                    <div class="flex-shrink-0 mt-1">
                        <div class="w-8 h-8 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center">
                            <i class="fas fa-clock text-red-600 dark:text-red-400"></i>
                        </div>
                    </div>
                    <div class="mr-3 flex-1">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">{{ deadline.title }}</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
                            {{ deadline.course.title }}
                        </p>
                        <div class="flex items-center mt-2">
                            <i class="fas fa-calendar text-red-500 text-xs mr-1"></i>
                            <span class="text-xs text-red-600 dark:text-red-400 font-medium">
                                {{ deadline.due_date|date:"d/m/Y" }}
                            </span>
                            <span class="mx-2">â€¢</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">
                                {{ deadline.due_date|timeuntil }}
                            </span>
                        </div>
                    </div>
                    <a href="{{ deadline.get_absolute_url }}" 
                       class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300">
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                </div>
                {% endfor %}
            </div>
            
            {% if upcoming_deadlines.count > 3 %}
            <div class="mt-4 text-center">
                <a href="{% url 'accounts:schedule' %}" 
                   class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300">
                    {% trans "Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯" %} <i class="fas fa-arrow-left mr-1"></i>
                </a>
            </div>
            {% endif %}
            
            {% else %}
            <div class="text-center py-6">
                <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
                    <i class="fas fa-check text-green-600 dark:text-green-400"></i>
                </div>
                <p class="text-gray-600 dark:text-gray-400 text-sm">
                    {% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠØ© Ù‚Ø±ÙŠØ¨Ø©. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø¹Ù…Ù„Ùƒ Ø§Ù„Ø±Ø§Ø¦Ø¹!" %}
                </p>
            </div>
            {% endif %}
        </div>
        
        <!-- Achievements -->
        <div class="dashboard-card rounded-xl p-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-trophy mr-2 text-yellow-500"></i>
                {% trans "Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª" %}
            </h2>
            
            <div class="text-center mb-6">
                <div class="relative inline-block">
                    <div class="achievement-badge mx-auto mb-3">
                        <i class="fas fa-gem text-2xl"></i>
                    </div>
                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-yellow-500 rounded-full flex items-center justify-center">
                        <span class="text-xs font-bold text-white">{{ user.achievements.count }}</span>
                    </div>
                </div>
                <h3 class="font-medium text-gray-900 dark:text-white mb-1">{% trans "Ø§Ù„Ù…ØªØ¹Ù„Ù… Ø§Ù„Ù…ØªÙ…ÙŠØ²" %}</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    {% trans "Ø­ØµÙ„Øª Ø¹Ù„Ù‰" %} {{ user.achievements.count }} {% trans "Ø¥Ù†Ø¬Ø§Ø²Ø§Øª" %}
                </p>
            </div>
            
            <div class="grid grid-cols-3 gap-3">
                {% for achievement in user.achievements.all|slice:":6" %}
                <div class="text-center group cursor-pointer" 
                     data-tooltip="{{ achievement.description }}">
                    <div class="achievement-badge mx-auto mb-2 {{ achievement.is_locked|yesno:'locked,' }}">
                        <i class="{{ achievement.icon }} text-xl"></i>
                    </div>
                    <p class="text-xs font-medium text-gray-900 dark:text-white truncate">
                        {{ achievement.title }}
                    </p>
                    <span class="text-xs text-gray-500 dark:text-gray-400">
                        {{ achievement.unlocked_at|date:"d/m/y" }}
                    </span>
                </div>
                {% endfor %}
            </div>
            
            {% if user.achievements.count > 6 %}
            <div class="mt-4 text-center">
                <a href="{% url 'accounts:achievements' %}" 
                   class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300">
                    {% trans "Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª" %} <i class="fas fa-arrow-left mr-1"></i>
                </a>
            </div>
            {% endif %}
        </div>
        
        <!-- Learning Goals -->
        <div class="dashboard-card rounded-xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white">
                    <i class="fas fa-bullseye mr-2 text-green-500"></i>
                    {% trans "Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªØ¹Ù„Ù…" %}
                </h2>
                <button id="addGoalBtn" 
                        class="p-2 rounded-lg bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400 hover:bg-green-200 dark:hover:bg-green-800 transition-colors">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            {% if learning_goals %}
            <div class="space-y-4">
                {% for goal in learning_goals|slice:":3" %}
                <div class="p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <input type="checkbox" 
                                   id="goal-{{ goal.id }}"
                                   class="w-4 h-4 text-green-600 rounded focus:ring-green-500"
                                   {% if goal.completed %}checked{% endif %}
                                   onchange="toggleGoal({{ goal.id }})">
                            <label for="goal-{{ goal.id }}" 
                                   class="mr-2 text-sm font-medium text-gray-900 dark:text-white {% if goal.completed %}line-through text-gray-500{% endif %}">
                                {{ goal.title }}
                            </label>
                        </div>
                        <span class="text-xs text-gray-500 dark:text-gray-400">
                            {{ goal.due_date|date:"d/m"|default:"Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®" }}
                        </span>
                    </div>
                    
                    <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                        <div class="flex items-center">
                            <i class="fas fa-book mr-1"></i>
                            <span>{{ goal.courses.count }} {% trans "Ø¯ÙˆØ±Ø©" %}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-16 h-1 bg-gray-300 dark:bg-gray-700 rounded-full overflow-hidden">
                                <div class="h-full bg-green-500" style="width: {{ goal.progress_percentage }}%"></div>
                            </div>
                            <span class="mr-2">{{ goal.progress_percentage }}%</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            {% if learning_goals.count > 3 %}
            <div class="mt-4 text-center">
                <a href="{% url 'accounts:goals' %}" 
                   class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300">
                    {% trans "Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù" %} <i class="fas fa-arrow-left mr-1"></i>
                </a>
            </div>
            {% endif %}
            
            {% else %}
            <div class="text-center py-6">
                <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
                    <i class="fas fa-bullseye text-gray-400"></i>
                </div>
                <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">
                    {% trans "Ø­Ø¯Ø¯ Ø£Ù‡Ø¯Ø§ÙÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ" %}
                </p>
                <button id="createFirstGoal" 
                        class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors">
                    <i class="fas fa-plus mr-1"></i>
                    {% trans "Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ù‡Ø¯Ù" %}
                </button>
            </div>
            {% endif %}
        </div>
        
        <!-- Recommendations -->
        <div class="dashboard-card rounded-xl p-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
                <i class="fas fa-lightbulb mr-2 text-blue-500"></i>
                {% trans "Ù…Ù‚ØªØ±Ø­Ø§Øª Ù„Ùƒ" %}
            </h2>
            
            <div class="space-y-4">
                {% for recommendation in recommendations|slice:":2" %}
                <a href="{{ recommendation.url }}" 
                   class="flex items-start p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors group">
                    <div class="flex-shrink-0 mt-1">
                        <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                            <i class="{{ recommendation.icon }} text-blue-600 dark:text-blue-400"></i>
                        </div>
                    </div>
                    <div class="mr-3 flex-1">
                        <p class="text-sm font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400">
                            {{ recommendation.title }}
                        </p>
                        <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
                            {{ recommendation.description }}
                        </p>
                    </div>
                    <i class="fas fa-arrow-left text-blue-400 group-hover:text-blue-600 dark:group-hover:text-blue-300 mt-2"></i>
                </a>
                {% empty %}
                <div class="text-center py-6">
                    <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                        <i class="fas fa-lightbulb text-blue-400"></i>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400 text-sm">
                        {% trans "Ø£ÙƒÙ…Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙˆØµÙŠØ§Øª Ù…Ø®ØµØµØ©" %}
                    </p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Goal Creation Modal -->
<div id="goalModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 dark:bg-opacity-70 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">{% trans "Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø¯Ù ØªØ¹Ù„Ù… Ø¬Ø¯ÙŠØ¯" %}</h3>
                <button id="closeGoalModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <form id="goalForm" class="space-y-4">
                {% csrf_token %}
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        {% trans "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‡Ø¯Ù" %}
                    </label>
                    <input type="text" 
                           name="title"
                           required
                           class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                           placeholder="{% trans 'Ù…Ø«Ø§Ù„: ØªØ¹Ù„Ù… Ø¨Ø±Ù…Ø¬Ø© Python ÙÙŠ 3 Ø£Ø´Ù‡Ø±' %}">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        {% trans "Ø§Ù„ÙˆØµÙ" %}
                    </label>
                    <textarea name="description"
                              rows="3"
                              class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                              placeholder="{% trans 'Ø§ÙƒØªÙ ÙˆØµÙØ§Ù‹ Ù…Ø®ØªØµØ±Ø§Ù‹ Ù„Ù‡Ø¯ÙÙƒ...' %}"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        {% trans "Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ" %}
                    </label>
                    <input type="date" 
                           name="due_date"
                           class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        {% trans "Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©" %}
                    </label>
                    <select name="courses"
                            multiple
                            class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        {% for course in user.courses_enrolled.all %}
                        <option value="{{ course.id }}">{{ course.title }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="flex justify-end space-x-3 rtl:space-x-reverse">
                    <button type="button" 
                            id="cancelGoalBtn"
                            class="px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors">
                        {% trans "Ø¥Ù„ØºØ§Ø¡" %}
                    </button>
                    <button type="submit" 
                            class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors">
                        {% trans "Ø­ÙØ¸ Ø§Ù„Ù‡Ø¯Ù" %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Initialize dashboard functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            
            const formatter = new Intl.DateTimeFormat('{{ request.LANGUAGE_CODE|default:"ar" }}', options);
            document.getElementById('currentTime').textContent = formatter.format(now);
        }
        
        updateCurrentTime();
        setInterval(updateCurrentTime, 60000); // Update every minute
        
        // Initialize progress chart
        let progressChart = null;
        function initializeProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            const chartLoading = document.getElementById('chartLoading');
            
            // Simulate data loading
            setTimeout(() => {
                if (chartLoading) {
                    chartLoading.style.display = 'none';
                }
                
                const period = document.getElementById('progressPeriod').value;
                const data = getChartData(period);
                
                if (progressChart) {
                    progressChart.destroy();
                }
                
                progressChart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim() || '#374151',
                                    font: {
                                        family: "'Cairo', sans-serif"
                                    }
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                rtl: true,
                                bodyFont: {
                                    family: "'Cairo', sans-serif"
                                },
                                titleFont: {
                                    family: "'Cairo', sans-serif"
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim() || '#374151',
                                    font: {
                                        family: "'Cairo', sans-serif"
                                    }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim() || '#374151',
                                    font: {
                                        family: "'Cairo', sans-serif"
                                    },
                                    callback: function(value) {
                                        return value + 'h';
                                    }
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'nearest'
                        }
                    }
                });
            }, 1000);
        }
        
        // Get chart data based on period
        function getChartData(period) {
            let labels = [];
            let learningData = [];
            let completionData = [];
            
            // Sample data - replace with actual API call
            switch(period) {
                case 'week':
                    labels = ['Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯'];
                    learningData = [2, 3, 2.5, 4, 3.5, 1, 2];
                    completionData = [0, 1, 0, 0, 1, 0, 0];
                    break;
                case 'month':
                    labels = ['Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1', 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 2', 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3', 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 4'];
                    learningData = [12, 15, 18, 14];
                    completionData = [2, 3, 4, 2];
                    break;
                case 'year':
                    labels = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
                    learningData = [45, 52, 48, 60, 55, 65, 70, 68, 75, 80, 85, 90];
                    completionData = [8, 10, 9, 12, 11, 15, 16, 14, 18, 20, 22, 25];
                    break;
                default:
                    labels = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ'];
                    learningData = [45, 52, 48, 60, 55, 65];
                    completionData = [8, 10, 9, 12, 11, 15];
            }
            
            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#e5e7eb' : '#374151';
            const gridColor = isDark ? 'rgba(255, 255, 255, 0.05)' : 'rgba(0, 0, 0, 0.05)';
            
            return {
                labels: labels,
                datasets: [
                    {
                        label: '{% trans "Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…" %}',
                        data: learningData,
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: '{% trans "Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©" %}',
                        data: completionData,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            };
        }
        
        // Initialize chart
        if (document.getElementById('progressChart')) {
            initializeProgressChart();
        }
        
        // Period selector change
        document.getElementById('progressPeriod').addEventListener('change', function() {
            const chartLoading = document.getElementById('chartLoading');
            if (chartLoading) {
                chartLoading.style.display = 'flex';
            }
            setTimeout(initializeProgressChart, 500);
        });
        
        // Refresh activity
        document.getElementById('refreshActivity').addEventListener('click', function() {
            const btn = this;
            const originalHtml = btn.innerHTML;
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;
            

        // Goal functionality
        const goalModal = document.getElementById('goalModal');
        const addGoalBtn = document.getElementById('addGoalBtn');
        const createFirstGoalBtn = document.getElementById('createFirstGoal');
        const closeGoalModal = document.getElementById('closeGoalModal');
        const cancelGoalBtn = document.getElementById('cancelGoalBtn');
        const goalForm = document.getElementById('goalForm');
        
        function openGoalModal() {
            goalModal.classList.remove('hidden');
            gsap.from(goalModal.querySelector('.bg-white'), {
                duration: 0.3,
                scale: 0.9,
                opacity: 0,
                ease: 'back.out(1.7)'
            });
        }
        
        function closeGoalModalFunc() {
            goalModal.classList.add('hidden');
        }
        
        if (addGoalBtn) {
            addGoalBtn.addEventListener('click', openGoalModal);
        }
        
        if (createFirstGoalBtn) {
            createFirstGoalBtn.addEventListener('click', openGoalModal);
        }
        
        if (closeGoalModal) {
            closeGoalModal.addEventListener('click', closeGoalModalFunc);
        }
        
        if (cancelGoalBtn) {
            cancelGoalBtn.addEventListener('click', closeGoalModalFunc);
        }
        
        goalModal.addEventListener('click', (e) => {
            if (e.target === goalModal) {
                closeGoalModalFunc();
            }
        });
       
        
        // Tooltips for achievements
        const achievementElements = document.querySelectorAll('[data-tooltip]');
        achievementElements.forEach(el => {
            el.addEventListener('mouseenter', function() {
                const tooltip = document.createElement('div');
                tooltip.className = 'absolute z-50 px-3 py-2 text-sm text-white bg-gray-900 rounded-lg shadow-lg';
                tooltip.textContent = this.dataset.tooltip;
                
                const rect = this.getBoundingClientRect();
                tooltip.style.left = `${rect.left + rect.width / 2}px`;
                tooltip.style.top = `${rect.top - 10}px`;
                tooltip.style.transform = 'translate(-50%, -100%)';
                
                document.body.appendChild(tooltip);
                this._tooltip = tooltip;
            });
            
            el.addEventListener('mouseleave', function() {
                if (this._tooltip) {
                    this._tooltip.remove();
                    this._tooltip = null;
                }
            });
        });
       
        
        // Dashboard animations
        gsap.from('.dashboard-card', {
            duration: 0.8,
            y: 30,
            opacity: 0,
            stagger: 0.1,
            scrollTrigger: {
                trigger: '.dashboard-card',
                start: 'top 80%',
            }
        });
        
        // Animate progress bars
        gsap.utils.toArray('.course-progress-fill').forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0%';
            
            gsap.to(bar, {
                width: width,
                duration: 1.5,
                ease: 'power2.out',
                scrollTrigger: {
                    trigger: bar.parentElement.parentElement,
                    start: 'top 80%',
                }
            });
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + G to add goal
            if ((e.ctrlKey || e.metaKey) && e.key === 'g') {
                e.preventDefault();
                openGoalModal();
            }
            
            // Ctrl/Cmd + R to refresh
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                document.getElementById('refreshActivity').click();
            }
        });
        
        // Export dashboard data
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + E to export
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportDashboardData();
            }
        });
        
        function exportDashboardData() {
            const data = {
                user: '{{ user.username }}',
                date: new Date().toISOString(),
                stats: {
                    enrolled_courses: {{ user.courses_enrolled.count }},
                    completed_courses: {{ user.completed_courses.count }},
                    learning_hours: {{ user.total_learning_hours|floatformat:1 }},
                    points: {{ user.get_points }}
                },
                active_courses: [
                    {% for enrollment in user.active_courses|slice:":3" %}
                    {
                        title: '{{ enrollment.course.title }}',
                        progress: {{ enrollment.progress_percentage }},
                        last_accessed: '{{ enrollment.last_accessed|date:"c" }}'
                    }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ]
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `dashboard_export_${new Date().getTime()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('{% trans "ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù†Ø¬Ø§Ø­" %}', 'success');
        }
        
    
    // Update dashboard stats dynamically
    function updateDashboardStats(data) {
        // Update counters with animation
        animateCounter('completed-courses-counter', data.completed_courses);
        animateCounter('learning-hours-counter', data.learning_hours);
        animateCounter('points-counter', data.points);
    }
    
    // Animate counter
    function animateCounter(elementId, targetValue) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        const currentValue = parseInt(element.textContent);
        if (currentValue === targetValue) return;
        
        gsap.to({}, {
            duration: 1,
            onUpdate: function() {
                const progress = this.progress();
                const value = Math.round(currentValue + (targetValue - currentValue) * progress);
                element.textContent = value;
            }
        });
    }
    
    // Notification function (from base template)
    window.showNotification = window.showNotification || function(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'} text-white`;
        notification.innerHTML = `
            <div class="flex items-center">
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} mr-3"></i>
                <span>${message}</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 10);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    };
</script>
{% endblock %}